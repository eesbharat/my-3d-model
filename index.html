<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GLB Viewer Pro ‚Äî Touch + Numeric View Controls</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%; width: 100%;
    display: flex;
    background: linear-gradient(180deg, #f4f4f4, #dcdcdc);
    color: #333; font-family: sans-serif;
    overflow: hidden;
  }

  #sidebar {
    width: 240px; min-width: 150px; max-width: 600px;
    background: rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
    border-right: 1px solid rgba(200,200,200,0.4);
    padding: 10px;
    overflow-y: auto;
    position: relative;
    z-index: 10;
    transition: width 0.2s;
  }

  #resizer {
    width: 6px;
    cursor: ew-resize;
    background: transparent;
    position: absolute;
    top: 0; right: -3px; bottom: 0;
    z-index: 5;
  }

  #viewer { flex: 1; position: relative; }
  canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

  #controls { display: flex; justify-content: space-between; margin-bottom: 8px; }
  #controls button {
    background: rgba(255,255,255,0.6);
    border: 1px solid #ccc; border-radius: 4px;
    padding: 4px 8px; cursor: pointer; font-size: 12px;
    transition: all 0.2s;
  }
  #controls button:hover { background: rgba(255,255,255,0.8); }

  ul { padding: 0; margin: 0; }
  li {
    list-style: none;
    margin: 3px 0;
    padding: 4px 6px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(4px);
  }
  li:hover { background: rgba(255,255,255,0.2); }
  li span {
    flex-grow: 1;
    margin-left: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  input[type="checkbox"] {
    width: 16px; height: 16px;
    accent-color: #333;
    cursor: pointer;
  }

  #sectionToggle {
    width: 100%;
    background: rgba(255,255,255,0.6);
    border: 1px solid #ccc; border-radius: 4px;
    padding: 6px; cursor: pointer;
    transition: all 0.2s;
  }
  #sectionToggle:hover { background: rgba(255,255,255,0.8); }

  /* Floating mobile controls */
  #viewControls {
    position: absolute;
    top: 10px; right: 10px;
    display: flex; flex-direction: column;
    gap: 6px;
    z-index: 20;
  }

  #viewControls button {
    background: rgba(255,255,255,0.7);
    border: 1px solid #bbb;
    border-radius: 8px;
    padding: 6px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  #viewControls button:hover {
    background: rgba(255,255,255,0.9);
  }

  @media (min-width: 768px) {
    #viewControls { display: none; }
  }
</style>
</head>
<body>
  <div id="sidebar">
    <h3>Model Parts</h3>
    <div id="controls">
      <button id="showAll">üëÅ Show All</button>
      <button id="hideAll">üö´ Hide All</button>
    </div>
    <ul id="tree"><li>Loading model...</li></ul>
    <hr>
    <button id="sectionToggle">‚úÇÔ∏è Toggle Section View</button>
    <div id="resizer"></div>
  </div>

  <div id="viewer">
    <div id="viewControls">
      <button data-view="front">üîÑ</button>
      <button data-view="back">‚è™</button>
      <button data-view="right">‚û°Ô∏è</button>
      <button data-view="left">‚¨ÖÔ∏è</button>
      <button data-view="top">üîº</button>
      <button data-view="bottom">üîΩ</button>
      <button data-view="iso">üß≠</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>

  <script>
  let scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf0f0f0);

  const aspect = window.innerWidth / window.innerHeight;
  const frustumSize = 3;
  let camera = new THREE.OrthographicCamera(
    (frustumSize * aspect) / -2,
    (frustumSize * aspect) / 2,
    frustumSize / 2,
    frustumSize / -2,
    -1000,
    1000
  );

  camera.position.set(3, 3, 3);
  camera.zoom = 2;
  camera.updateProjectionMatrix();

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.getElementById('viewer').appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enableRotate = true;
  controls.screenSpacePanning = false;
  controls.minZoom = 0.2;
  controls.maxZoom = 5;
  controls.target.set(0, 0, 0);
  controls.update();

  const hemiLight = new THREE.HemisphereLight(0xffffff, 0xaaaaaa, 1.2);
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
  dirLight.position.set(5, 10, 7);
  scene.add(hemiLight, dirLight);

  let model;
  const loader = new THREE.GLTFLoader();
  loader.load('model.glb', (gltf) => {
    model = gltf.scene;
    scene.add(model);
    buildTree(model);

    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z);
    const scale = 1.5 / maxDim;
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));

    controls.target.set(0, 0, 0);
    controls.update();
  });

  function buildTree(object3D) {
    const tree = document.getElementById('tree');
    tree.innerHTML = '';
    const partsMap = new Map();

    object3D.traverse((child) => {
      if (child.isMesh) {
        let parentName = child.parent?.name?.trim() || child.name || '(Unnamed Part)';
        if (!partsMap.has(parentName)) partsMap.set(parentName, []);
        partsMap.get(parentName).push(child);
      }
    });

    partsMap.forEach((meshes, name) => {
      const li = document.createElement('li');
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.checked = true;
      cb.addEventListener('change', () => meshes.forEach(m => m.visible = cb.checked));

      const label = document.createElement('span');
      label.textContent = name;
      li.appendChild(label);
      li.appendChild(cb);
      tree.appendChild(li);
    });

    document.getElementById('showAll').onclick = () => {
      tree.querySelectorAll('input[type="checkbox"]').forEach(cb => { cb.checked = true; cb.dispatchEvent(new Event('change')); });
    };
    document.getElementById('hideAll').onclick = () => {
      tree.querySelectorAll('input[type="checkbox"]').forEach(cb => { cb.checked = false; cb.dispatchEvent(new Event('change')); });
    };
  }

  // Sectional View Toggle
  let clippingEnabled = false;
  const sectionButton = document.getElementById('sectionToggle');
  sectionButton.addEventListener('click', () => {
    clippingEnabled = !clippingEnabled;
    renderer.clippingPlanes = clippingEnabled
      ? [new THREE.Plane(new THREE.Vector3(0, -1, 0), 0)]
      : [];
    sectionButton.style.background = clippingEnabled ? 'rgba(255,200,200,0.7)' : 'rgba(255,255,255,0.6)';
  });

  // Resizable Sidebar
  const sidebar = document.getElementById('sidebar');
  const resizer = document.getElementById('resizer');
  let isResizing = false;
  resizer.addEventListener('mousedown', () => {
    isResizing = true;
    document.body.style.cursor = 'ew-resize';
  });
  document.addEventListener('mousemove', (e) => {
    if (!isResizing) return;
    const newWidth = Math.min(Math.max(e.clientX, 150), 600);
    sidebar.style.width = newWidth + 'px';
  });
  document.addEventListener('mouseup', () => {
    isResizing = false;
    document.body.style.cursor = 'default';
  });

  // Keyboard and Touch Camera Controls
  function setCameraView(dir) {
    const speed = 3;
    const positions = {
      front: [0, 0, speed],
      back: [0, 0, -speed],
      right: [speed, 0, 0],
      left: [-speed, 0, 0],
      top: [0, speed, 0],
      bottom: [0, -speed, 0],
      iso: [speed, speed, speed]
    };

    if (positions[dir]) {
      const [x, y, z] = positions[dir];
      new TWEEN.Tween(camera.position)
        .to({ x, y, z }, 500)
        .easing(TWEEN.Easing.Quadratic.Out)
        .onUpdate(() => controls.update())
        .start();
    }
  }

  window.addEventListener('keydown', (e) => {
    switch (e.key) {
      case '1': setCameraView('front'); break;
      case '2': setCameraView('back'); break;
      case '3': setCameraView('right'); break;
      case '4': setCameraView('left'); break;
      case '5': setCameraView('top'); break;
      case '6': setCameraView('bottom'); break;
      case '0': setCameraView('iso'); break;
    }
  });

  document.querySelectorAll('#viewControls button').forEach(btn => {
    btn.addEventListener('click', () => setCameraView(btn.dataset.view));
  });

  // Tween animation library
  const tweenScript = document.createElement('script');
  tweenScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js';
  document.body.appendChild(tweenScript);

  function animate(time) {
    requestAnimationFrame(animate);
    if (window.TWEEN) TWEEN.update(time);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
  </script>
</body>
</html>